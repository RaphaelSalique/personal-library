personal-library:ci:
    tags:
        - firstci
    image: php:8.1
    before_script:
        # Install dependencies
        - bash ci/docker_install.sh > /dev/null
    script:
        - composer install
        - ./vendor/bin/phpmd src text phpmd.xml
        - ./vendor/bin/phpcs --standard=PSR12 src
        - ./vendor/bin/phpstan analyse src --level=8
#        - ./bin/phpunit On attend que Google ait fix√© les erreurs de GoogleApi

sonarqube-check:
    tags:
        - firstci
    image:
        name: sonarsource/sonar-scanner-cli:latest
        entrypoint: [""]
    variables:
        SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
        GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
    cache:
        key: "${CI_JOB_NAME}"
        paths:
            - .sonar/cache
    script:
        - sonar-scanner
    allow_failure: true
    rules:
        - if: $CI_COMMIT_BRANCH == 'develop'
